//      ________       _       __           __                        ___
//     /_  __/ /_  ___| |     / /___  _____/ /_____  __________      /  /
//      / / / __ \/ _ \ | /| / / __ \/ ___/ //_/ _ \/ ___/ ___/     /  /
//     / / / / / /  __/ |/ |/ / /_/ / /  / ,< /  __/ /  (__  )    _/ ./
//    /_/ /_/ /_/\___/|__/|__/\____/_/  /_/|_|\___/_/  /____/    / ./
//                                                      .net    / /
//                                                         .   /./
//    W.js - http://theworkers.github.com/W.js/       ..   |  //  .
//                                                 .   \\  | /' .'  .
//                                                  ~-. `     ' .-~
//
//    Portions of W.js are inspired or borrowed from:
//     - [underscore.js](http://underscorejs.org/)
//     - [backbone.js](http://backbonejs.org/)
//     - [pathjs](https://github.com/mtrpcic/pathjs)
//
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.version="2.1.0";var nativeForEach=Array.prototype.forEach,nativeBind=Function.prototype.bind,slice=Array.prototype.slice,breaker={};W.extend=function(obj){return W.each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},W.each=function(obj,iterator,context){if(obj===null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};var ctor=function(){};W.bind=function bind(fn,scope){var bound,args;return fn.bind===nativeBind&&nativeBind?nativeBind.apply(fn,slice.call(arguments,1)):(args=slice.call(arguments,2),bound=function(){if(this instanceof bound){ctor.prototype=fn.prototype;var self=new ctor,result=fn.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return fn.apply(scope,args.concat(slice.call(arguments)))})},W.clone=function(obj){var target={};for(var i in obj)obj.hasOwnProperty(i)&&(target[i]=obj[i]);return target},W.use=function(lib,context){return lib=typeof lib=="string"?W.snippet[lib]:lib,context?(W.extend(context,lib),lib):(W.extend(W,lib),lib)},W.loop=function(iterations,fn,callback){var index=0,done=!1,end=function(){done=!0,callback()},next=function(){if(done)return;index<iterations?(index++,fn(index-1,next,end)):(done=!0,callback&&callback())};return next(),next}})();////
/// W
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W;var ctor=function(){},inherits=function(parent,protoProps,staticProps){var child;return protoProps&&protoProps.hasOwnProperty("constructor")?child=protoProps.constructor:child=function(){parent.apply(this,arguments)},W.extend(child,parent),ctor.prototype=parent.prototype,child.prototype=new ctor,protoProps&&W.extend(child.prototype,protoProps),staticProps&&W.extend(child,staticProps),child.prototype.constructor=child,child.__super__=parent.prototype,child},extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);return child.extend=this.extend,child};W.Object=function(){},W.Object.extend=extend})();////
/// W.HSLGradient
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W;var hue2rgb=function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+(q-p)*6*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p},hslToRgb=function(h,s,l){var r,g,b;if(s===0)r=g=b=l;else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return[r*255,g*255,b*255]};W.HSLtoStringMixin={toRGBString:function(){var rgb=hslToRgb(this.h/255-.2,this.s/100,this.l/100);return"rgb("+~~rgb[0]+","+~~rgb[1]+","+~~rgb[2]+")"},toHSLString:function(){return"rgb("+~~this.h+","+~~this.s+","+~~this.l+")"}},W.HSLGradient=W.Object.extend({version:1,constructor:function(initColor){this._hStops=[],this._sStops=[],this._lStops=[],this._hasChanged=!1,this._resolution=10,this._gradientArray=undefined},addColorStop:function(position,color){var wrappedPointColor;W.extend(color,W.HSLtoStringMixin),_.isUndefined(color.h)||(wrappedPointColor={position:position,value:color.h},this._hStops.splice(_.sortedIndex(this._hStops,wrappedPointColor,function(pointColor){return pointColor.position}),0,wrappedPointColor),this._hasChanged=!0),_.isUndefined(color.s)||(wrappedPointColor={position:position,value:color.s},this._sStops.splice(_.sortedIndex(this._sStops,wrappedPointColor,function(pointColor){return pointColor.position}),0,wrappedPointColor),this._hasChanged=!0),_.isUndefined(color.l)||(wrappedPointColor={position:position,value:color.l},this._lStops.splice(_.sortedIndex(this._lStops,wrappedPointColor,function(pointColor){return pointColor.position}),0,wrappedPointColor),this._hasChanged=!0)},resolution:function(res){return arguments.length&&res!=this._resolution&&(this._resolution=res),this._resolution},compute:function(res){this._resolution=res||this._resolution;var computedArray=[];for(var i=0;i<this._resolution;i++){var percentOfResultion=i/this._resolution,color={};color.h=this._calcPoint(percentOfResultion,this._hStops),color.s=this._calcPoint(percentOfResultion,this._sStops),color.l=this._calcPoint(percentOfResultion,this._lStops),W.extend(color,W.HSLtoStringMixin),computedArray.push(color)}return this._gradientArray=computedArray,this._hasChange=!1,this._gradientArray},getGradientArray:function(res){var resolution=res||this._resolution;return(!this._gradientArray||!this._hasChange||this._resolution!==resolution)&&this.compute(resolution),this._gradientArray},_calcPoint:function(position,stops){if(!stops||stops.length===0)return 0;if(stops.length===1)return stops[0].value;if(position<=_.first(stops).position)return _.first(stops).value;if(position>=_.last(stops).position)return _.last(stops).value;var lowStop,highStop;_(stops).each(function(stop,i){position>stop.position&&(lowStop=stops[i],highStop=stops[i+1])},this),lowStop===undefined&&(console.log(position),console.log(stops));var relativePosition=(position-lowStop.position)/(highStop.position-lowStop.position),relativeChange=highStop.value-lowStop.value,value=relativeChange*relativePosition+lowStop.value;return value}})})();////
/// W.Router
// @author Ross Cairns
// Based on [pathjs](https://github.com/mtrpcic/pathjs) by Mike Trpcic. Stripped to not use the location hash matching
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.Router=W.Object.extend({version:"2.0.0",constructor:function(){this.routes={fallback:null}},map:function(path){if(this.routes.hasOwnProperty(path))return this.routes[path];var route=new W.Route({path:path,router:this});return this.routes[path]=route,route},fallback:function(fn){return this.routes.fallback=fn},match:function(path){var params={},route=null,i=null;for(route in this.routes)if(route!==null&&route!==undefined){var compare=path;if(route.indexOf(":")>-1)for(i=0;i<route.split("/").length;i++)i<compare.split("/").length&&route.split("/")[i].charAt(0)===":"&&(params[route.split("/")[i].replace(":","")]=compare.split("/")[i],compare=compare.replace(compare.split("/")[i],route.split("/")[i]));if(route===compare)return this.routes[route].params=params,this.routes[route]}return!1},trigger:function(path){var match=this.match(path);return match?match.run():this.routes.fallback!==null&&this.routes.fallback(),this}}),W.Route=W.Object.extend({constructor:function(options){this.path=options.path,this.router=options.router,this.action=null,this.params={}},to:function(fn,context){return context&&(fn=W.bind(fn,context)),this.action=fn,this.router},run:function(){this.router.routes[this.path].action(this.router.routes[this.path].params)}})})();////
/// W.Timer
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.Timer=W.Object.extend({constructor:function(options){W.extend(this,W.EventMixin),this.options=W.extend({updateTime:1e3,loops:!0,eventName:"fired",stoppedEventName:"stop",restartEventName:"restart"},options),this.setIntervalID=undefined,this._count=0},restart:function(){return clearInterval(this._intervalId),this.trigger("restarting",this),this.start(),this},start:function(){return this._intervalId?!1:(this.lastUpdate=(new Date).getTime(),this._intervalId=setInterval(W.bind(this.update,this),10),!0)},stopTimer:function(){return this._intervalId?(clearInterval(this._intervalId),this._intervalId=undefined,this.trigger(this.options.stoppedEventName,this),!0):!1},update:function(){var currentTime=(new Date).getTime();return this.options.updateTime+this.lastUpdate<currentTime&&(this._count++,this.trigger(this.options.eventName,this),this.options.loops?this.lastUpdate=currentTime:this.stopTimer()),this},count:function(){return this._count},resetCounter:function(){this._count=0}})})();////
/// W.TouchEventViewMixin
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.TouchEventViewMixin={version:1,enableTouchEvents:function(){this.el.ontouchstart=_.bind(function(event){this.trigger("touchStart",event)},this),this.el.ontouchmove=_.bind(function(event){this.trigger("touchMove",event)},this),this.el.ontouchend=_.bind(function(event){this.trigger("touchEnd",event)},this),this.el.ontouchcancel=_.bind(function(event){this.trigger("touchCancel",event)},this)}}})();////
/// W.EventMixin
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.EventMixin={version:2,on:function(event,callback,scope){if(typeof callback!="function")throw"callback not function";this.events()[event]=this.events()[event]||[],this.events()[event]&&(scope?this.events()[event].push(W.bind(callback,scope)):this.events()[event].push(callback))},off:function(event,callback){if(!callback)throw"No callback function given for 2nd argument of `removeEventlistener` so can not remove event listener. Be sure to store the event callback as a varible if you wish to remove it";if(this.events()[event]){var listeners=this.events()[event];for(var i=listeners.length-1;i>=0;--i)if(listeners[i]===callback)return listeners.splice(i,1),!0}return!1},trigger:function(event,eventData){var data=eventData||{};if(this.events()[event]){var listeners=this.events()[event],len=listeners.length;if(len<=0)return!1;while(len--)typeof listeners[len]=="function"&&listeners[len](data);return!0}return!1},events:function(){return this.eventsArray=this.eventsArray||[],this.eventsArray}},W.EventMixin.version=2})();////
/// W.DisplayViewMixin
// @author Ross Cairns
// @notes  Not suitable for heavy usage (i.e. particles) as produces 
//         many object with in turn will cause big
//         garbage collections delays 
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.DisplayViewMixin={version:1,setPosition:function(x,y){return typeof x=="[object Array]"?(this.x(x[0]),this.y(y[1])):typeof x=="number"?(this.x(x),this.y(y)):(this.x(x.x),this.y(x.y)),this},setSize:function(width,height){if(!width.tagName||typeof jQuery!="function")if(!width.tagName)if(typeof width=="number")this.width(width),this.height(height);else if(typeof width=="array")this.width(width[0]),this.height(width[1]);else if(typeof width=="function")this.width(width()),this.height(height());else{var obj=width;this.width(typeof obj.width=="function"?obj.width():obj.width),this.height(typeof obj.height=="function"?obj.height():obj.height)}else this.width=width.width,this.height=width.height;else this.width(jQuery(width).width()),this.height(jQuery(width).height());return this},x:function(x){return arguments.length>0&&(this._x=x),typeof this._x=="undefined"&&(this._x=0),this._x},y:function(y){return arguments.length>0&&(this._y=y),typeof this._y=="undefined"&&(this._y=0),this._y},width:function(width){return arguments.length>0&&(this._width=width),typeof this._width=="undefined"&&(this._width=0),this._width},height:function(height){return arguments.length>0&&(this._height=height),typeof this._height=="undefined"&&(this._height=0),this._height}}})();////
/// W.CountedCallbackMixin
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.CountedCallbackMixin={getCountedCallback:function(){var self=this;return self._totalCallbacks=self._totalCallbacks||0,self._totalCallbacks++,this.callbackComplete=this.callbackComplete||function(){--self._totalCallbacks||self.trigger("allCallbacksComplete",self)},this.callbackComplete}}})();////
/// W.snippet.dom
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.snippet=W.snippet||{},W.snippet.dom=W.dom||{},W.snippet.dom.version="2.0.0",W.snippet.dom.viewportSize=function(){var e=window,a="inner";return"innerWidth"in window||(a="client",e=document.documentElement||document.body),{width:e[a+"Width"],height:e[a+"Height"]}},W.snippet.dom.cssGradientString=function(stops){var values=[],_direction="left",promise={direction:function(direction){return _direction=direction,promise},add:function(precentage,value){return values.push([precentage,value]),promise},get:function(){var str="-webkit-linear-gradient("+_direction+", ";for(var i=0;i<values.length;i++)str+=values[i][1]+" "+values[i][0]+"%",i<values.length-1&&(str+=",");return str+=")",str}};return promise};var privateNamespace={};(function(namespace){function chainMethod(fn,scope,chainReturn){return function(){return fn.apply(scope,arguments)||chainReturn}}function chainProperty(propName,scope,chainReturn){return function(value){return typeof value=="undefined"?scope[propName]:(scope[propName]=value,chainReturn)}}var _context2DMethods="arc arcTo beginPath bezierCurveTo clearRect clip closePath createImageData createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate save scale setTransform stroke strokeRect strokeText transform translate".split(" "),_context2DProperties="canvas fillStyle font globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor strokeStyle textAlign textBaseline".split(" ");namespace.Context2DWrapper=function(target){var n=_context2DMethods.length,curProp;this.context=target;while(n--)curProp=_context2DMethods[n],this[curProp]=chainMethod(target[curProp],target,this);n=_context2DProperties.length;while(n--)curProp=_context2DProperties[n],this[curProp]=chainProperty(curProp,target,this)}})(privateNamespace),W.snippet.dom.wrappedContext=function(context){return new privateNamespace.Context2DWrapper(context)}})();////
/// W.snippet.math
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.snippet=W.snippet||{},W.snippet.math=W.math||{},W.snippet.math.version="2.0.0",W.snippet.math.clipNormalized=function(x,min,max){return arguments.length===2?(max=min,min=0):arguments.length===1&&(max=1,min=0),x<min?min:x>max?max:x},W.snippet.math.fitScaleRatio=function(width,height,boundsWidth,boundsHeight){var widthScale=boundsWidth/width,heightScale=boundsHeight/height;return Math.min(widthScale,heightScale)},W.snippet.math.map=function(value,inputMin,inputMax,outputMin,outputMax,clamp){var outVal=(value-inputMin)/(inputMax-inputMin)*(outputMax-outputMin)+outputMin;return clamp&&(outputMax<outputMin?outVal<outputMax?outVal=outputMax:outVal>outputMin&&(outVal=outputMin):outVal>outputMax?outVal=outputMax:outVal<outputMin&&(outVal=outputMin)),outVal},W.snippet.math.randomBetween=function(from,to){return W.snippet.math.map(Math.random(),0,1,from,to)},W.snippet.math.close=function(num,test,tolerance){return tolerance=tolerance||1,num>test-tolerance&&num<test+tolerance},W.snippet.math.angleBetween=function(center,point){var angle=Math.atan2(center.x-point.x,center.y-point.y)*(180/Math.PI);return angle<0?angle=Math.abs(angle):angle=360-angle,angle},W.snippet.math.distance=function(obj1,obj2){var x=obj2.x-obj1.x,y=obj2.y-obj1.y;return Math.sqrt(x*x+y*y)},W.snippet.math.shuffleArray=function(arr,leaveOriginalUntouched){var array=leaveOriginalUntouched?arr.slice(0):arr,tmp,current,top=array.length;if(top)while(--top)current=Math.floor(Math.random()*(top+1)),tmp=array[current],array[current]=array[top],array[top]=tmp;return array},W.snippet.math.colorStringToHex=function(color){if(color.substr(0,1)==="#")return color;var digits=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(color),red=parseInt(digits[2],10),green=parseInt(digits[3],10),blue=parseInt(digits[4],10),rgb=blue|green<<8|red<<16;return digits[1]+"#"+rgb.toString(16)},W.snippet.math.colorValuesToHex=function(r,g,b){var red=parseInt(r,10),green=parseInt(g,10),blue=parseInt(b,10),rgb=blue|green<<8|red<<16;return"#"+rgb.toString(16)}})();////
/// W.ColorUtil
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.RandomColorSequence=W.Object.extend({constructor:function(options){this.r=Math.random()*255,this.g=Math.random()*255,this.b=Math.random()*255,this.rStep=Math.random()*10-5,this.gStep=Math.random()*10-5,this.bStep=Math.random()*10-5},start:function(){return this.timer||(this.timer=new W.Timer({updateTime:10}),this.timer.on("fired",this.update,this)),this.timer.start(),this},stop:function(){return this.timer.stop(),this.timer.off("fired",this.update),this.timer=undefined,this},update:function(){return this.r+=this.rStep,this.g+=this.gStep,this.b+=this.bStep,this.r>255&&(this.r=0+(this.r-255)),this.r<0&&(this.r=255-this.r),this.g>255&&(this.g=0+(this.g-255)),this.g<0&&(this.g=255-this.g),this.b>255&&(this.b=0+(this.b-255)),this.b<0&&(this.b=255-this.b),this},getHex:function(){return W.colorValuesToHex(this.r&this.r,this.g&this.g,this.b&this.b)}})})();////
/// W.snippet.social
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.snippet=W.snippet||{},W.snippet.social=W.social||{},W.snippet.social.version="2.0.0",W.snippet.social.twitter=W.snippet.social.tiwtter||{},W.snippet.social.twitter.tweet=function(options){var string=W.use("string");if(!string.hasTld(window.location.href)&&console){console.warn("window.location.href does not have a top level domain, will not tweet");return}var twitterurl="https://twitter.com/share?";if(!options||!options.message)throw"no message to send to twitter";twitterurl+="&text="+encodeURIComponent(string.trim(options.message)),options&&options.link&&(twitterurl+="&url="+options.link),window.open(twitterurl,"twitterwindow","height=450, width=550, top="+($(window).height()/2-225)+", left="+$(window).width()/2+", toolbar=0, menubar=0, directories=0, scrollbars=0")},W.snippet.social.facebook=W.snippet.social.facebook||{},W.snippet.social.facebook.post=function(options){var string=W.use("string");if(!string.hasTld(window.location.href)&&console){console.warn("window.location.href does not have a top level domain, will not post on facebook");return}var facebookurl="http://www.facebook.com/sharer.php?";options&&options.link&&(facebookurl+="&u="+encodeURIComponent(string.trim(options.link))),options&&options.message&&(facebookurl+="&t="+encodeURIComponent(string.trim(options.message))),console.log(facebookurl),window.open(facebookurl,"facebookwindow","height=400, width=800, top="+($(window).height()/2-225)+", left="+$(window).width()/2+", toolbar=0, menubar=0, directories=0, scrollbars=0")}})();////
/// W.snippet.string
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.snippet=W.snippet||{},W.snippet.string=W.string||{},W.snippet.string.version="2.0.0",W.snippet.string.addCommas=function(number){number=""+number;if(number.indexOf(",")>0)return number;if(number.length>3){var mod=number.length%3,output=mod>0?number.substring(0,mod):"";for(i=0;i<Math.floor(number.length/3);i++)mod===0&&i===0?output+=number.substring(mod+3*i,mod+3*i+3):output+=","+number.substring(mod+3*i,mod+3*i+3);return output}return number},W.snippet.string.contains=function(str,test){return str.indexOf(test)!=-1},W.snippet.string.trim=function(str){return str.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")},W.snippet.string.startsWith=function(str,test){return str.slice(0,test.length)==test},W.snippet.string.endsWith=function(str,test){return str.slice(-test.length)==test},W.snippet.string.hasTld=function(str){var result=str.match(/[a-z0-9.\-]+[.][a-z]{1,4}[\/:]?([\d]{1,5})?/m);return!!result}})();////
/// W.ColorUtil
// @author Ross Cairns
(function(){var root=this,W=root.W||{};typeof module!="undefined"&&module.exports?(module.exports=W,root.W=W):root.W=W,W.RandomColorSequence=W.Object.extend({constructor:function(options){this.r=Math.random()*255,this.g=Math.random()*255,this.b=Math.random()*255,this.rStep=Math.random()*10-5,this.gStep=Math.random()*10-5,this.bStep=Math.random()*10-5},start:function(){return this.timer||(this.timer=new W.Timer({updateTime:10}),this.timer.on("fired",this.update,this)),this.timer.start(),this},stop:function(){return this.timer.stop(),this.timer.off("fired",this.update),this.timer=undefined,this},update:function(){return this.r+=this.rStep,this.g+=this.gStep,this.b+=this.bStep,this.r>255&&(this.r=0+(this.r-255)),this.r<0&&(this.r=255-this.r),this.g>255&&(this.g=0+(this.g-255)),this.g<0&&(this.g=255-this.g),this.b>255&&(this.b=0+(this.b-255)),this.b<0&&(this.b=255-this.b),this},getHex:function(){return W.colorValuesToHex(this.r&this.r,this.g&this.g,this.b&this.b)}})})();